import{b as C,c as i,d as b}from"./chunk-LIHITQLG.js";import{b as g}from"./chunk-PD3M4KJI.js";import{G as m,N as c,T as d,a as u,m as l,q as o,x as p}from"./chunk-IFOETVGF.js";var y={1:"Interactivo",2:"Assincrono"};function f(e){let{items:t}=i(e);return t.map(N)}function N(e){let t=e.ClassGroups??[],s=t.reduce((a,n)=>a+(n.ApprovedEnrollments??0),0),r=t.reduce((a,n)=>a+(n.Capacity??0),0);return{id:e.Id,title:e.Title,modeLabel:y[e.Mode]??"Assincrono",category:e.CategoryName,instructor:e.InstructorName,published:e.IsPublished,publishedAt:e.PublishedAt,enrolledStudents:s,capacity:r,classGroups:t.length}}function h(e,t=new Date){let s=new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});return e.flatMap(r=>(r.ClassGroups??[]).map(n=>{let I=n.ApprovedEnrollments??0,D=n.Capacity??0,v=P(n,t),E=T(n,s);return{id:n.Id,courseId:r.Id,courseTitle:r.Title,name:n.Name,capacity:D,occupied:I,requiresApproval:n.RequiresApproval,status:v,nextEvent:E}}))}function P(e,t){let s=e.EndsAt?new Date(e.EndsAt):void 0,r=e.StartsAt?new Date(e.StartsAt):void 0;return s&&!Number.isNaN(s.getTime())&&s.getTime()<t.getTime()?"Concluida":r&&!Number.isNaN(r.getTime())&&r.getTime()<=t.getTime()?"Em andamento":"Inscricoes abertas"}function T(e,t){let s=e.StartsAt?new Date(e.StartsAt):null,r=e.EndsAt?new Date(e.EndsAt):null;return s&&!Number.isNaN(s.getTime())&&s.getTime()>Date.now()?`Inicio \xB7 ${t.format(s).replace(".","")}`:r&&!Number.isNaN(r.getTime())?`Fim previsto \xB7 ${t.format(r).replace(".","")}`:"Agenda nao definida"}var A=class e{http=d(g);baseUrl=C.baseUrl;cache$;getCourseCards(t={}){return this.fetchCoursesDto(t).pipe(o(f))}getCoursesDto(){return this.fetchCoursesDto().pipe(o(t=>i(t).items))}getClassGroupRows(){return this.fetchCoursesDto().pipe(o(t=>i(t).items),o(t=>h(t)))}fetchCoursesDto(t={}){if(!this.cache$||Object.keys(t).length){let s=b(u({PageSize:50},t)),r=this.http.get(`${this.baseUrl}/courses`,{params:s}).pipe(p(()=>l({dados:[]})),m({bufferSize:1,refCount:!0}));return Object.keys(t).length===0&&(this.cache$=r),r}return this.cache$}static \u0275fac=function(s){return new(s||e)};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})};export{A as a};
