<section class="activities">
  <header>
    <div>
      <h2>Atividades avaliativas</h2>
      <p class="description">
        {{ isInstructor() ? 'Organize prazos e acompanhe a distribuicao das atividades por turma.' : 'Atividades liberadas para voce nas turmas em que esta matriculado.' }}
      </p>
    </div>
    <button *ngIf="isInstructor()" type="button">Criar atividade</button>
  </header>

  <ng-container *ngIf="!loading(); else loadingState">
    <ng-container *ngIf="!error(); else errorState">
      <div class="activity-filters" *ngIf="isStudent()">
        <span class="filter-label">Filtrar:</span>
        <button
          type="button"
          class="filter-chip"
          [class.filter-chip--active]="activityStatusFilter() === 'all'"
          (click)="setActivityStatusFilter('all')"
        >
          Todas
        </button>
        <button
          type="button"
          class="filter-chip"
          [class.filter-chip--active]="activityStatusFilter() === 'pending'"
          (click)="setActivityStatusFilter('pending')"
        >
          Pendentes
        </button>
        <button
          type="button"
          class="filter-chip"
          [class.filter-chip--active]="activityStatusFilter() === 'completed'"
          (click)="setActivityStatusFilter('completed')"
        >
          Realizadas
        </button>
      </div>

      <div class="activities__list" *ngIf="displayedActivities().length; else emptyState">
        <article *ngFor="let activity of displayedActivities(); trackBy: trackByActivity" class="activity">
          <div class="activity__meta">
            <h3>{{ activity.title }}</h3>
            <span class="tag">{{ activity.allowLate ? 'Aceita atrasos' : 'Sem prorrogacao' }}</span>
          </div>

          <dl>
            <div>
              <dt>Prazo</dt>
              <dd>{{ activity.dueDateLabel }}</dd>
            </div>
            <div>
              <dt>Turma</dt>
              <dd>{{ isStudent() ? activity.classGroupName : activityGroupLabel(activity) }}</dd>
            </div>
            <div>
              <dt>Anexos</dt>
              <dd>{{ activity.attachments }}</dd>
            </div>
          </dl>

          <footer>
            <button type="button" (click)="viewActivity(activity)">Ver detalhes</button>
            <button *ngIf="isInstructor()" type="button" class="secondary" (click)="manageCorrections(activity)">
              Gerenciar correcoes
            </button>
          </footer>
        </article>
      </div>
    </ng-container>
  </ng-container>
</section>

<ng-template #loadingState>
  <div class="state state--info">Carregando atividades...</div>
</ng-template>

<ng-template #errorState>
  <div class="state state--error">{{ error() }}</div>
</ng-template>

<ng-template #emptyState>
  <div class="state state--info">Nenhuma atividade cadastrada por enquanto.</div>
</ng-template>
