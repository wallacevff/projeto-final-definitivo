<section class="student-dashboard" *ngIf="isStudentView(); else instructorView">
  <header class="student-dashboard__header">
    <div>
      <h2>Meus cursos</h2>
      <p class="lead">Continue acompanhando as trilhas em que você já está matriculado.</p>
    </div>
    <span class="enrollment-count">
      {{ studentCourses().length }} curso{{ studentCourses().length === 1 ? '' : 's' }} matriculado{{ studentCourses().length === 1 ? '' : 's' }}
    </span>
  </header>

  <ng-container *ngIf="!loading(); else loadingState">
    <ng-container *ngIf="!error(); else errorState">
      <ng-container *ngIf="studentCourses().length; else emptyState">
        <div class="student-dashboard__grid">
          <article *ngFor="let course of studentCourses(); trackBy: trackByCourse" class="student-course-card">
            <div class="student-course-card__head">
              <span class="badge">{{ course.category || 'Sem categoria' }}</span>
              <span class="mode">{{ course.modeLabel }}</span>
            </div>

            <h3>{{ course.title }}</h3>
            <p class="instructor">Instrutor: <strong>{{ course.instructor || 'Nao informado' }}</strong></p>
            <p class="enrollment-meta" *ngIf="course.enrollmentType === 'distribution'">
              Distribuicao de materiais
            </p>
            <p class="enrollment-meta" *ngIf="course.enrollmentType === 'interactive'">
              Turma {{ course.classGroupName || 'interativa' }}
              <span [class]="enrollmentStatusClass(course.enrollmentStatus)">
                {{ enrollmentStatusLabel(course.enrollmentStatus) }}
              </span>
            </p>

            <dl class="student-course-card__stats">
              <div>
                <dt>Turmas</dt>
                <dd>{{ course.classGroups }}</dd>
              </div>
              <div>
                <dt>Vagas ocupadas</dt>
                <dd>{{ course.enrolledStudents }}/{{ course.capacity || 'Ilimitado' }}</dd>
              </div>
              <div>
                <dt>
                  {{ course.enrollmentType === 'interactive' && course.enrollmentStatus === 1 ? 'Solicitado em' : 'Matriculado em' }}
                </dt>
                <dd>{{ course.subscribedAt | date:'dd/MM/yyyy' }}</dd>
              </div>
            </dl>

            <button
              type="button"
              class="student-course-card__cta"
              (click)="openCourse(course.id)"
              [disabled]="!canAccessCourse(course)"
            >
              {{ canAccessCourse(course) ? 'Acessar curso' : 'Aguardando aprovacao' }}
            </button>
            <small
              class="student-course-card__hint"
              *ngIf="!canAccessCourse(course) && course.enrollmentType === 'interactive'"
            >
              Aguarde a aprovacao da turma para acessar os materiais.
            </small>
          </article>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</section>

<ng-template #instructorView>
  <section class="dashboard">
    <header class="dashboard__header">
      <div>
        <h2>Bem-vindo de volta!</h2>
        <p class="lead">Aqui estão alguns indicadores rápidos para acompanhar o aprendizado dos seus alunos.</p>
      </div>
      <button type="button" class="action" (click)="goToCreateCourse()">Criar novo curso</button>
    </header>

    <div class="dashboard__highlights">
      <article *ngFor="let card of highlightCards" class="highlight" [attr.data-trend]="card.trend">
        <span class="highlight__label">{{ card.label }}</span>
        <strong class="highlight__value">{{ card.value }}</strong>
        <span class="highlight__context">{{ card.context }}</span>
      </article>
    </div>

    <section class="dashboard__timeline">
      <h3>Próximos marcos</h3>
      <ol>
        <li *ngFor="let item of timeline">
          <div class="timeline__date">{{ item.date }}</div>
          <div class="timeline__details">
            <h4>{{ item.title }}</h4>
            <p>{{ item.description }}</p>
          </div>
        </li>
      </ol>
    </section>
  </section>
</ng-template>

<ng-template #loadingState>
  <div class="state state--info">Carregando seus cursos...</div>
</ng-template>

<ng-template #errorState>
  <div class="state state--error">{{ error() }}</div>
</ng-template>

<ng-template #emptyState>
  <div class="state">Você ainda não está matriculado em nenhum curso.</div>
</ng-template>
